document.addEventListener('DOMContentLoaded', () => {
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const scoreDisplay = document.getElementById('score');
    const timerDisplay = document.getElementById('time');
    const message = document.getElementById('message');
    const restartButton = document.getElementById('restart-button');
    const startButton = document.getElementById('start-button');
    const difficultySelect = document.getElementById('difficulty');
    const attemptsDisplay = document.getElementById('attempts-left');
    const quizContainer = document.querySelector('.quiz');
    const musicToggleButton = document.getElementById('toggle-music');
    const musicIcon = document.getElementById('music-icon'); // IcÃ´ne de musique
    const backgroundMusic = document.getElementById('background-music');
    const backButton = document.getElementById('back-button'); 

    let questions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let remainingTime = 60;
    let timer;
    let gameEnded = false;
    let attemptsLeft = 3;
    let difficultyLevel = '';

    const localQuestions = {
        easy: [
            {
                question: "Quel est le plus grand ocÃ©an du monde ?",
                options: ["Atlantique", "Indien", "Arctique", "Pacifique"],
                answer: "Pacifique"
            },
            {
                question: "Qui a Ã©crit 'Harry Potter' ?",
                options: ["J.K. Rowling", "Stephen King", "George R.R. Martin", "J.R.R. Tolkien"],
                answer: "J.K. Rowling"
            },
            {
                question: "Quelle est la couleur du ciel par une journÃ©e ensoleillÃ©e ?",
                options: ["Rouge", "Bleu", "Vert", "Jaune"],
                answer: "Bleu"
            },
            {
                question: "Quel est le plus grand continent du monde ?",
                options: ["Afrique", "AmÃ©rique", "Asie", "Europe"],
                answer: "Asie"
            },
            {
                question: "Combien de jours y a-t-il dans une semaine ?",
                options: ["5", "6", "7", "8"],
                answer: "7"
            },
            {
                question : "Quel est le plus grand fleuve d'Europe ?",
                options: ["Danube", "Rhin", "Volga", "Seine"],
                answer: "Volga"
            },
            {
                question : "Qui a peint la Mona Lisa ?",
                options: ["Michel-Ange", "RaphaÃ«l", "LÃ©onard de Vinci", "Botticelli"],
                answer: "LÃ©onard de Vinci"
            },
            {
                question : "Quel est le symbole chimique du sodium ?",
                options: ["Na", "Sn", "Fe", "Au"],
                answer: "Na"
            },
            {
                question: "Quel est l'organe principal du systÃ¨me respiratoire humain ?",
                options: ["CÅ“ur", "Foie", "Poumon", "Rein"],
                answer: "Poumon"
            },
            {
                question: "Quelle est la capitale de l'Espagne ?",
                options: ["Madrid", "Barcelone", "SÃ©ville", "Valence"],
                answer: "Madrid"
            },
            {
                question: "Quel est l'animal emblÃ©matique de l'Australie ?",
                options: ["Kangourou", "Koala", "Dingo", "Emu"],
                answer: "Kangourou"
            },
        ],
        medium: [
            {
                question: "Quelle est la capitale de l'Australie ?",
                options: ["Sydney", "Melbourne", "Canberra", "Brisbane"],
                answer: "Canberra"
            },
            {
                question: "Quel est le symbole chimique de l'or ?",
                options: ["Au", "Ag", "O", "G"],
                answer: "Au"
            },
            {
                question: "Quel est le plus grand dÃ©sert du monde ?",
                options: ["Sahara", "Gobi", "Kalahari", "Arctique"],
                answer: "Sahara"
            },
            {
                question: "Qui a peint la Joconde ?",
                options: ["Vincent Van Gogh", "Pablo Picasso", "Leonardo da Vinci", "Claude Monet"],
                answer: "Leonardo da Vinci"
            },
            {
                question: "Quelle est la plus grande planÃ¨te du systÃ¨me solaire ?",
                options: ["Terre", "Mars", "Jupiter", "Saturne"],
                answer: "Jupiter"
            },
            {
                question: "Quelle est la plus haute montagne du monde ?",
                options: ["Mont Everest", "Mont Kilimandjaro", "Mont Fuji", "Mont McKinley"],
                answer: "Mont Everest"
            },
            {
                question: "Qui a Ã©crit 'Don Quichotte' ?",
                options: ["Miguel de Cervantes", "Federico GarcÃ­a Lorca", "Gabriel GarcÃ­a MÃ¡rquez", "Jorge Luis Borges"],
                answer: "Miguel de Cervantes"
            },
            {
                question: "Quel est le plus grand lac salÃ© au monde ?",
                options: ["Mer Morte", "Grand Lac SalÃ©", "Lac Assal", "Lac Tchad"],
                answer: "Grand Lac SalÃ©"
            },
            {
                question: "Quel est le plus grand producteur de cafÃ© au monde ?",
                options: ["BrÃ©sil", "Colombie", "Vietnam", "Ã‰thiopie"],
                answer: "BrÃ©sil"
            },
            {
                question: "Quelle est la monnaie officielle du Japon ?",
                options: ["Yen", "Dollar", "Euro", "Won"],
                answer: "Yen"
            },
            {
                question: "Quelle est la capitale du Japon ?",
                options: ["PÃ©kin", "SÃ©oul", "Tokyo", "Manille"],
                answer: "Tokyo"
            },
            {
                question: "Quel est le plus grand dÃ©sert chaud du monde ?",
                options: ["Sahara", "Gobi", "Kalahari", "Atacama"],
                answer: "Sahara"
            },
            {
                question: "Qui a Ã©crit 'Les MisÃ©rables' ?",
                options: ["Gustave Flaubert", "Ã‰mile Zola", "Victor Hugo", "Charles Baudelaire"],
                answer: "Victor Hugo"
            },
            {
                question: "Quel est le plus grand lac d'eau douce au monde ?",
                options: ["Lac SupÃ©rieur", "Lac BaÃ¯kal", "Lac Victoria", "Lac Michigan"],
                answer: "Lac SupÃ©rieur"
            }
        ],
        hard: [
            {
                question: "Qui a dÃ©veloppÃ© la thÃ©orie de la relativitÃ© ?",
                options: ["Isaac Newton", "Albert Einstein", "Galileo Galilei", "Nikola Tesla"],
                answer: "Albert Einstein"
            },
            {
                question: "En quelle annÃ©e a eu lieu la RÃ©volution franÃ§aise ?",
                options: ["1789", "1799", "1769", "1779"],
                answer: "1789"
            },
            {
                question: "Quel est le plus long fleuve du monde ?",
                options: ["Nil", "Amazon", "Yangtze", "Mississippi"],
                answer: "Amazon"
            },
            {
                question: "Qui a Ã©crit 'Ã€ la recherche du temps perdu' ?",
                options: ["Marcel Proust", "Victor Hugo", "Ã‰mile Zola", "Albert Camus"],
                answer: "Marcel Proust"
            },
            {
                question: "Quel est l'Ã©lÃ©ment chimique le plus abondant dans l'univers ?",
                options: ["OxygÃ¨ne", "Carbone", "HydrogÃ¨ne", "Azote"],
                answer: "HydrogÃ¨ne"
            },
            {
                question: "Qui a inventÃ© le tÃ©lÃ©phone ?",
                options: ["Alexander Graham Bell", "Thomas Edison", "Nikola Tesla", "Guglielmo Marconi"],
                answer: "Alexander Graham Bell"
            },
            {
                question: "Quel est le plus grand producteur de diamants au monde ?",
                options: ["Afrique du Sud", "Russie", "Australie", "Canada"],
                answer: "Russie"
            },
            {
                question: "Quelle est la plus grande barriÃ¨re de corail du monde ?",
                options: ["Belize Barrier Reef", "Great Barrier Reef", "New Caledonia Barrier Reef", "Palawan Barrier Reef"],
                answer: "Great Barrier Reef"
            },
            {
                question: "Quel est le pays le plus peuplÃ© au monde ?",
                options: ["Inde", "Chine", "Ã‰tats-Unis", "Russie"],
                answer: "Chine"
            },
            {
                question: "Qui a inventÃ© l'ampoule Ã©lectrique ?",
                options: ["Thomas Edison", "Nikola Tesla", "Alexander Graham Bell", "Benjamin Franklin"],
                answer: "Thomas Edison"
            }
        ]
    };


    // Toggle music
    musicToggleButton.addEventListener('click', () => {
        if (backgroundMusic.paused) {
            backgroundMusic.play();
            musicIcon.textContent = 'ðŸ”‡';
        } else {
            backgroundMusic.pause();
            musicIcon.textContent = 'ðŸŽµ';
        }
    });

    // Initialise le jeu
    function initGame() {
        difficultyLevel = difficultySelect.value;
        questions = localQuestions[difficultyLevel];
        currentQuestionIndex = 0;
        score = 0;
        attemptsLeft = 3;
        gameEnded = false;

        scoreDisplay.textContent = score;
        attemptsDisplay.textContent = attemptsLeft;

        document.querySelector('.difficulty-selection').classList.add('hidden');
        quizContainer.classList.remove('hidden');
        message.classList.add('hidden');
        restartButton.classList.add('hidden');
        backButton.classList.remove('hidden');

        startTimer();
        displayQuestion();
    }

    // Affiche une question
    function displayQuestion() {
        const currentQuestion = questions[currentQuestionIndex];
        questionText.textContent = currentQuestion.question;
        optionsContainer.innerHTML = '';

        currentQuestion.options.forEach(option => {
            const button = document.createElement('button');
            button.textContent = option;
            button.classList.add('styled-button');
            button.addEventListener('click', () => checkAnswer(option));
            optionsContainer.appendChild(button);
        });
    }

    // VÃ©rifie la rÃ©ponse
    function checkAnswer(selectedOption) {
        const currentQuestion = questions[currentQuestionIndex];

        if (selectedOption === currentQuestion.answer) {
            score++;
            scoreDisplay.textContent = score;
            message.textContent = "Bonne rÃ©ponse !";
            message.classList.remove('hidden');
            message.classList.add('correct');
            message.classList.remove('incorrect');
        } else {
            message.textContent = `Mauvaise rÃ©ponse. La bonne rÃ©ponse Ã©tait: ${currentQuestion.answer}`;
            message.classList.remove('hidden');
            message.classList.remove('correct');
            message.classList.add('incorrect');
            attemptsLeft--;
            attemptsDisplay.textContent = attemptsLeft;
        }

        setTimeout(() => {
            message.classList.add('hidden');
            nextQuestion();
        }, 2000);
    }

    // Passe Ã  la question suivante
    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex >= questions.length || attemptsLeft <= 0) {
            endGame();
        } else {
            displayQuestion();
        }
    }

    // Termine le jeu
    function endGame() {
        clearInterval(timer);
        message.textContent = `Quiz terminÃ©! Votre score est de ${score} sur ${questions.length}.`;
        message.classList.remove('hidden');
        restartButton.classList.remove('hidden');
        gameEnded = true;
    }

    // RedÃ©marre le jeu
    restartButton.addEventListener('click', () => {
        clearInterval(timer);
        score = 0;
        attemptsLeft = 3;
        scoreDisplay.textContent = score;
        attemptsDisplay.textContent = attemptsLeft;
        initGame();
    });

    // Retour Ã  la sÃ©lection de difficultÃ©
    backButton.addEventListener('click', () => {
        clearInterval(timer);
        quizContainer.classList.add('hidden');
        document.querySelector('.difficulty-selection').classList.remove('hidden');
        backButton.classList.add('hidden'); // Masque le bouton de retour
    });

    // Initialise le jeu lorsque le bouton "DÃ©marrer" est cliquÃ©
    startButton.addEventListener('click', initGame);

    // Fonction de gestion du minuteur
    function startTimer() {
        remainingTime = 60;
        timerDisplay.textContent = remainingTime;

        timer = setInterval(() => {
            if (remainingTime > 0) {
                remainingTime--;
                timerDisplay.textContent = remainingTime;
            } else {
                clearInterval(timer);
                message.textContent = 'Temps Ã©coulÃ©!';
                message.classList.remove('hidden');
                endGame();
            }
        }, 1000);
    }

    // Charge le jeu par dÃ©faut au chargement de la page
    backgroundMusic.volume = 0.3; // RÃ©glez le volume de la musique de fond ici
});


